<?xml version="1.0" encoding="utf-8"?>
<network-security-config>
    <!-- =================================================================== -->
    <!-- DÉVELOPPEMENT LOCAL : Autoriser HTTP pour les IPs locales          -->
    <!-- =================================================================== -->
    <domain-config cleartextTrafficPermitted="true">
        <!-- Localhost et émulateurs -->
        <domain includeSubdomains="true">localhost</domain>
        <domain includeSubdomains="true">10.0.2.2</domain>
        <domain includeSubdomains="true">127.0.0.1</domain>
        
        <!-- Réseaux locaux pour développement -->
        <domain includeSubdomains="true">192.168.1.1</domain>
        <domain includeSubdomains="true">192.168.1.100</domain>
        <domain includeSubdomains="true">192.168.0.1</domain>
        <domain includeSubdomains="true">192.168.0.100</domain>
        
        <!-- Réseau 10.x.x.x pour certains réseaux d'entreprise -->
        <domain includeSubdomains="true">10.0.0.1</domain>
        <domain includeSubdomains="true">10.0.1.1</domain>
        
        <!-- ngrok pour développement (temporaire) -->
        <domain includeSubdomains="true">*.ngrok.io</domain>
        <domain includeSubdomains="true">*.ngrok-free.app</domain>
        
        <!-- Socket.io polling fallback nécessite ces domaines -->
        <domain includeSubdomains="true">engineio.com</domain>
        <domain includeSubdomains="true">socket.io</domain>
    </domain-config>
    
    <!-- =================================================================== -->
    <!-- STAGING/PREPROD : HTTPS uniquement avec WebSocket                  -->
    <!-- =================================================================== -->
    <domain-config cleartextTrafficPermitted="false">
        <domain includeSubdomains="true">api.preprod.pos.mokengeli-biloko.com</domain>
        <domain includeSubdomains="true">preprod.pos.mokengeli-biloko.com</domain>
        
        <!-- Configuration TLS pour WebSocket -->
        <trust-anchors>
            <certificates src="system"/>
            <!-- Accepter les certificats Let's Encrypt -->
            <certificates src="user" overridePins="false"/>
        </trust-anchors>
        
        <!-- Certificate pinning optionnel pour staging -->
        <!-- À activer une fois les certificats stables -->
        <!--
        <pin-set expiration="2025-12-31">
            <pin digest="SHA-256">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=</pin>
            <pin digest="SHA-256">BACKUP_PIN_HERE</pin>
        </pin-set>
        -->
    </domain-config>

    <!-- =================================================================== -->
    <!-- PRODUCTION : HTTPS uniquement avec sécurité renforcée              -->
    <!-- =================================================================== -->
    <domain-config cleartextTrafficPermitted="false">
        <domain includeSubdomains="true">api.pos.mokengeli-biloko.com</domain>
        <domain includeSubdomains="true">pos.mokengeli-biloko.com</domain>
        
        <!-- Configuration TLS stricte pour production -->
        <trust-anchors>
            <certificates src="system"/>
            <!-- Ne PAS accepter les certificats utilisateur en production -->
        </trust-anchors>
        
        <!-- Certificate pinning pour production (recommandé) -->
        <!-- Remplacer par les vrais hashes SHA-256 de vos certificats -->
        <!--
        <pin-set expiration="2026-01-01">
            <pin digest="SHA-256">YOUR_PRODUCTION_CERT_SHA256_HERE</pin>
            <pin digest="SHA-256">BACKUP_CERT_SHA256_HERE</pin>
        </pin-set>
        -->
    </domain-config>
    
    <!-- =================================================================== -->
    <!-- IMPRIMANTES RÉSEAU LOCAL : Autoriser HTTP pour les imprimantes     -->
    <!-- =================================================================== -->
    <domain-config cleartextTrafficPermitted="true">
        <!-- IPs spécifiques pour imprimantes (Android ne supporte pas les ranges) -->
        <!-- IP de votre imprimante actuelle -->
        <domain includeSubdomains="true">192.168.1.159</domain>
        
        <!-- Autres IPs potentielles -->
        <domain includeSubdomains="true">192.168.1.151</domain>
        <domain includeSubdomains="true">192.168.1.152</domain>
        <domain includeSubdomains="true">192.168.1.153</domain>
        <domain includeSubdomains="true">192.168.1.154</domain>
        <domain includeSubdomains="true">192.168.1.155</domain>
        <domain includeSubdomains="true">192.168.1.156</domain>
        <domain includeSubdomains="true">192.168.1.157</domain>
        <domain includeSubdomains="true">192.168.1.158</domain>
        <domain includeSubdomains="true">192.168.1.160</domain>
        
        <!-- IPs communes pour imprimantes réseau -->
        <domain includeSubdomains="true">192.168.1.200</domain>
        <domain includeSubdomains="true">192.168.1.201</domain>
        <domain includeSubdomains="true">192.168.1.202</domain>
        <domain includeSubdomains="true">192.168.1.250</domain>
        <domain includeSubdomains="true">192.168.1.251</domain>
        <domain includeSubdomains="true">192.168.1.252</domain>
        <domain includeSubdomains="true">192.168.1.253</domain>
        <domain includeSubdomains="true">192.168.1.254</domain>
        
        <!-- Même chose pour le réseau 192.168.0.x -->
        <domain includeSubdomains="true">192.168.0.151</domain>
        <domain includeSubdomains="true">192.168.0.152</domain>
        <domain includeSubdomains="true">192.168.0.200</domain>
        <domain includeSubdomains="true">192.168.0.250</domain>
        
        <!-- Ports d'imprimantes courants -->
        <!-- Note: Android ne permet pas de spécifier les ports directement -->
        <!-- Ces domaines couvrent les imprimantes IPP/HTTP -->
        <domain includeSubdomains="true">*.local</domain>
        <domain includeSubdomains="true">printer.local</domain>
    </domain-config>

    <!-- =================================================================== -->
    <!-- CONFIGURATION PAR DÉFAUT : Production sécurisée                    -->
    <!-- =================================================================== -->
    <base-config cleartextTrafficPermitted="false">
        <trust-anchors>
            <!-- Certificats système uniquement par défaut -->
            <certificates src="system"/>
        </trust-anchors>
    </base-config>

    <!-- =================================================================== -->
    <!-- DEBUG OVERRIDES : Pour développement uniquement                    -->
    <!-- =================================================================== -->
    <debug-overrides>
        <!-- En mode debug, accepter tous les certificats -->
        <trust-anchors>
            <certificates src="system"/>
            <certificates src="user"/>
        </trust-anchors>
        
        <!-- Autoriser le trafic clair en debug (dev local) -->
        <base-config cleartextTrafficPermitted="true">
            <trust-anchors>
                <certificates src="system"/>
                <certificates src="user"/>
            </trust-anchors>
        </base-config>
    </debug-overrides>
</network-security-config>